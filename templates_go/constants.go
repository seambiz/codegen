package main

import (
	"github.com/seambiz/codegen/config"
	"github.com/seambiz/codegen/gen"
)

type Constants struct{}

func (Constants) Generate(conf *config.Config) string {
	g := gen.NewGenerator()

	g.Package(conf.RootPackage)

	g.Comment("GENERATED BY CODEGEN.")
	g.NewLine()

	g.Comment("constants for each table's columns")

	g.ConstFn(func() {
		iotaSet := false
		for _, schema := range conf.Schemas {
			for _, t := range schema.Tables {
				if t.Generate {
					g.NewLine()
					g.Comment("Columns for table ", schema.Name, ".", t.Name)
					for _, f := range t.Fields {
						if iotaSet {
							g.Go(t.Title, "_", f.Title)
						} else {
							g.Go(t.Title, "_", f.Title, " = iota")
							iotaSet = true
						}
					}
				}
			}
		}
	})

	g.NewLine()
	g.Comment("^^ END OF GENERATED BY CODEGEN. ^^")

	return g.String()
}
